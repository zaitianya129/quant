# Aè‚¡é‡åŒ–ç³»ç»Ÿ - Dockeréƒ¨ç½²æŒ‡å—

## ğŸ¯ æ–¹æ¡ˆä¼˜åŠ¿

âœ… **æœ¬åœ°é…ç½®ï¼ŒæœåŠ¡å™¨ç›´æ¥è¿è¡Œ**
âœ… **ç¯å¢ƒå®Œå…¨ä¸€è‡´**ï¼ˆå¼€å‘=ç”Ÿäº§ï¼‰
âœ… **ä¸€é”®éƒ¨ç½²ï¼Œ5åˆ†é’Ÿä¸Šçº¿**
âœ… **æ˜“äºæ‰©å±•å’Œè¿ç§»**

---

## ğŸ“‹ å‡†å¤‡å·¥ä½œ

### 1. æœ¬åœ°ç¯å¢ƒè¦æ±‚
- âœ… å®‰è£…Docker Desktop (macOS/Windows)
- âœ… å®‰è£…Git (ç”¨äºä»£ç ç®¡ç†)
- âœ… è·å–Tushare Token ([æ³¨å†Œåœ°å€](https://tushare.pro/register))

### 2. é˜¿é‡Œäº‘æœåŠ¡å™¨å‡†å¤‡
- âœ… è´­ä¹°è½»é‡åº”ç”¨æœåŠ¡å™¨æˆ–ECSï¼ˆ2æ ¸4Gå³å¯ï¼‰
- âœ… æ“ä½œç³»ç»Ÿ: Ubuntu 22.04 æˆ– CentOS 7+
- âœ… å¼€æ”¾ç«¯å£: 22(SSH), 80(HTTP), 5000(åº”ç”¨)
- âœ… å®‰è£…Docker (æœåŠ¡å™¨ä¸Šæ‰§è¡Œ)

---

## ğŸš€ éƒ¨ç½²æ–¹å¼é€‰æ‹©

### æ–¹å¼A: ç›´æ¥éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼ˆæœ€ç®€å•ï¼‰â­â­â­â­â­

**é€‚åˆ**: ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼Œæƒ³å¿«é€Ÿä¸Šçº¿

```bash
# æ­¥éª¤1: æœ¬åœ°é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env  # å¡«å…¥TUSHARE_TOKEN

# æ­¥éª¤2: æ„å»ºå¹¶æ¨é€ï¼ˆè‡ªåŠ¨åŒ–è„šæœ¬ï¼‰
chmod +x deploy-aliyun.sh
./deploy-aliyun.sh  # æŒ‰æç¤ºè¾“å…¥é˜¿é‡Œäº‘ä¿¡æ¯
```

### æ–¹å¼B: ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒä»“åº“ï¼ˆæ¨èï¼‰â­â­â­â­â­

**é€‚åˆ**: é•¿æœŸä½¿ç”¨ï¼Œæ”¯æŒç‰ˆæœ¬ç®¡ç†

è¯¦è§ä¸‹æ–¹å®Œæ•´æ­¥éª¤

### æ–¹å¼C: æœ¬åœ°æµ‹è¯•åæ‰‹åŠ¨éƒ¨ç½²ï¼ˆæœ€çµæ´»ï¼‰â­â­â­

**é€‚åˆ**: éœ€è¦å……åˆ†æµ‹è¯•å†ä¸Šçº¿

è¯¦è§ä¸‹æ–¹å®Œæ•´æ­¥éª¤

---

## ğŸ“ å®Œæ•´éƒ¨ç½²æ­¥éª¤ï¼ˆæ–¹å¼Bï¼‰

### ç¬¬ä¸€æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
nano .env
```

ç¼–è¾‘å†…å®¹ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰:
```bash
TUSHARE_TOKEN=ä½ çš„token    # âš ï¸ å¿…é¡»å¡«å†™
SECRET_KEY=éšæœºå­—ç¬¦ä¸²       # å»ºè®®ä¿®æ”¹
```

### ç¬¬äºŒæ­¥ï¼šæœ¬åœ°æµ‹è¯•ï¼ˆå¯é€‰ä½†æ¨èï¼‰

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy-local.sh

# æœ¬åœ°æ„å»ºå¹¶è¿è¡Œ
./deploy-local.sh

# æµ‹è¯•è®¿é—®
open http://localhost:5000
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… æœç´¢è‚¡ç¥¨ "000001"
- âœ… æŸ¥çœ‹åˆ†æç»“æœ
- âœ… ç¡®è®¤æ•°æ®æ­£å¸¸

### ç¬¬ä¸‰æ­¥ï¼šæ³¨å†Œé˜¿é‡Œäº‘é•œåƒä»“åº“

1. ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°
2. æœç´¢"å®¹å™¨é•œåƒæœåŠ¡"ï¼ˆå…è´¹ç‰ˆå³å¯ï¼‰
3. åˆ›å»ºå‘½åç©ºé—´ï¼ˆå¦‚: `quant`ï¼‰
4. åˆ›å»ºé•œåƒä»“åº“ï¼ˆå¦‚: `quant-system`ï¼‰
5. è®°å½•ä»¥ä¸‹ä¿¡æ¯ï¼š
   ```
   ä»“åº“åœ°å€: registry.cn-hangzhou.aliyuncs.com
   å‘½åç©ºé—´: quant
   ç”¨æˆ·å: ä½ çš„é˜¿é‡Œäº‘è´¦å·
   å¯†ç : è®¾ç½®çš„é•œåƒä»“åº“å¯†ç 
   ```

### ç¬¬å››æ­¥ï¼šä¿®æ”¹éƒ¨ç½²è„šæœ¬é…ç½®

ç¼–è¾‘ `deploy-aliyun.sh`ï¼š

```bash
# ä¿®æ”¹è¿™äº›é…ç½®
ALIYUN_REGISTRY="registry.cn-hangzhou.aliyuncs.com"
ALIYUN_NAMESPACE="quant"  # ä½ åˆ›å»ºçš„å‘½åç©ºé—´
SERVER_HOST="47.xxx.xxx.xxx"  # ä½ çš„æœåŠ¡å™¨IP
SERVER_USER="root"
```

### ç¬¬äº”æ­¥ï¼šæœåŠ¡å™¨å‡†å¤‡

SSHç™»å½•æœåŠ¡å™¨ï¼Œæ‰§è¡Œï¼š

```bash
# å®‰è£…Docker
curl -fsSL https://get.docker.com | bash

# å¯åŠ¨Docker
systemctl start docker
systemctl enable docker

# åˆ›å»ºæ•°æ®ç›®å½•
mkdir -p /data/quant/cache /data/quant/logs

# è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆé‡è¦ï¼ï¼‰
export TUSHARE_TOKEN="ä½ çš„token"
echo 'export TUSHARE_TOKEN="ä½ çš„token"' >> ~/.bashrc
```

### ç¬¬å…­æ­¥ï¼šæ‰§è¡Œéƒ¨ç½²

æœ¬åœ°æ‰§è¡Œï¼š

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy-aliyun.sh

# ä¸€é”®éƒ¨ç½²
./deploy-aliyun.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. ç™»å½•é˜¿é‡Œäº‘é•œåƒä»“åº“
2. æ„å»ºDockeré•œåƒ
3. æ¨é€åˆ°é˜¿é‡Œäº‘
4. SSHåˆ°æœåŠ¡å™¨
5. æ‹‰å–é•œåƒå¹¶å¯åŠ¨

### ç¬¬ä¸ƒæ­¥ï¼šéªŒè¯éƒ¨ç½²

```bash
# æ–¹å¼1: æµè§ˆå™¨è®¿é—®
http://ä½ çš„æœåŠ¡å™¨IP:5000

# æ–¹å¼2: SSHåˆ°æœåŠ¡å™¨æ£€æŸ¥
ssh root@ä½ çš„æœåŠ¡å™¨IP
docker ps  # æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€
docker logs quant-web -f  # æŸ¥çœ‹æ—¥å¿—
```

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨æœ¬åœ°ç¯å¢ƒ
docker-compose up -d quant-web

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f quant-web

# åœæ­¢æœåŠ¡
docker-compose down

# é‡æ–°æ„å»º
docker-compose up -d --build
```

### æœåŠ¡å™¨ç®¡ç†

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
docker logs quant-web -f

# é‡å¯å®¹å™¨
docker restart quant-web

# åœæ­¢å®¹å™¨
docker stop quant-web

# åˆ é™¤å®¹å™¨
docker rm quant-web

# æ›´æ–°ä»£ç ï¼ˆæœ¬åœ°ä¿®æ”¹åï¼‰
# 1. æœ¬åœ°æ‰§è¡Œ: ./deploy-aliyun.sh
# 2. è‡ªåŠ¨å®Œæˆæ›´æ–°
```

---

## ğŸ¨ è¿›é˜¶é…ç½®

### 1. æ·»åŠ Nginxåå‘ä»£ç†ï¼ˆå¯é€‰ï¼‰

å¦‚æœè¦ç”¨80ç«¯å£è®¿é—®ï¼š

```bash
# ç¼–è¾‘ docker-compose.ymlï¼Œå–æ¶ˆnginxçš„æ³¨é‡Š
docker-compose up -d nginx

# è®¿é—®
http://ä½ çš„æœåŠ¡å™¨IP  # ä¸éœ€è¦ç«¯å£å·
```

### 2. é…ç½®åŸŸåï¼ˆå¯é€‰ï¼‰

```bash
# 1. åŸŸåDNSè§£æï¼ŒAè®°å½•æŒ‡å‘æœåŠ¡å™¨IP
# 2. ä¿®æ”¹ nginx/nginx.conf ä¸­çš„ server_name
server_name your-domain.com;

# 3. é‡å¯nginx
docker restart quant-nginx
```

### 3. é…ç½®HTTPSï¼ˆå¯é€‰ï¼‰

```bash
# ä½¿ç”¨Let's Encryptå…è´¹è¯ä¹¦
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ:

# å®‰è£…certbot
apt install certbot

# ç”³è¯·è¯ä¹¦
certbot certonly --standalone -d your-domain.com

# ä¿®æ”¹nginxé…ç½®ä½¿ç”¨è¯ä¹¦
# è¯ä¹¦ä½ç½®: /etc/letsencrypt/live/your-domain.com/
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: æœ¬åœ°æ„å»ºæŠ¥é”™ "Cannot connect to Docker daemon"
**A**: Docker Desktopæœªå¯åŠ¨ï¼Œè¯·å¯åŠ¨Docker Desktop

### Q2: æ¨é€é•œåƒå¤±è´¥ "denied: requested access to the resource is denied"
**A**:
1. æ£€æŸ¥æ˜¯å¦ç™»å½•: `docker login registry.cn-hangzhou.aliyuncs.com`
2. æ£€æŸ¥å‘½åç©ºé—´å’Œä»“åº“åæ˜¯å¦æ­£ç¡®

### Q3: æœåŠ¡å™¨æ‹‰å–é•œåƒå¾ˆæ…¢
**A**:
1. ä½¿ç”¨é˜¿é‡Œäº‘çš„é•œåƒåŠ é€Ÿå™¨
2. é€‰æ‹©ä¸æœåŠ¡å™¨åŒåŒºåŸŸçš„é•œåƒä»“åº“ï¼ˆå¦‚æœåŠ¡å™¨åœ¨åä¸œï¼Œç”¨cn-hangzhouï¼‰

### Q4: å®¹å™¨å¯åŠ¨åç«‹å³é€€å‡º
**A**: æŸ¥çœ‹æ—¥å¿—æ’æŸ¥
```bash
docker logs quant-web
# å¸¸è§åŸå› : TUSHARE_TOKENæœªè®¾ç½®
```

### Q5: è®¿é—®http://IP:5000 æ— æ³•æ‰“å¼€
**A**:
1. æ£€æŸ¥é˜²ç«å¢™/å®‰å…¨ç»„æ˜¯å¦å¼€æ”¾5000ç«¯å£
2. æ£€æŸ¥å®¹å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ: `docker ps`

---

## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¿—æŸ¥çœ‹

```bash
# åº”ç”¨æ—¥å¿—
docker logs quant-web -f --tail 100

# é”™è¯¯æ—¥å¿—
docker exec quant-web tail -f logs/error.log

# è®¿é—®æ—¥å¿—
docker exec quant-web tail -f logs/access.log
```

### æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats quant-web

# è¿›å…¥å®¹å™¨
docker exec -it quant-web bash
```

### å¤‡ä»½

```bash
# å¤‡ä»½æ•°æ®åº“
tar -czf quant-backup-$(date +%Y%m%d).tar.gz /data/quant/cache

# å¤‡ä»½åˆ°æœ¬åœ°
scp root@æœåŠ¡å™¨IP:/data/quant/cache/*.db ./backup/
```

---

## ğŸ‰ æ€»ç»“

å®Œæˆä»¥ä¸Šæ­¥éª¤åï¼Œä½ å°±æ‹¥æœ‰äº†ï¼š

âœ… æœ¬åœ°å¼€å‘ç¯å¢ƒ
âœ… è‡ªåŠ¨åŒ–éƒ¨ç½²æµç¨‹
âœ… ç”Ÿäº§ç¯å¢ƒè¿è¡Œç³»ç»Ÿ
âœ… å®Œæ•´çš„ç‰ˆæœ¬ç®¡ç†

**æ›´æ–°æµç¨‹**ï¼ˆåªéœ€3æ­¥ï¼‰ï¼š
1. æœ¬åœ°ä¿®æ”¹ä»£ç 
2. è¿è¡Œ `./deploy-aliyun.sh`
3. è‡ªåŠ¨éƒ¨ç½²å®Œæˆ âœ¨

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œæ£€æŸ¥é¡ºåºï¼š
1. æŸ¥çœ‹æœ¬æ–‡æ¡£å¸¸è§é—®é¢˜
2. æŸ¥çœ‹Dockeræ—¥å¿—
3. æœç´¢é”™è¯¯ä¿¡æ¯
4. GitHub Issues
