# A股量化买卖点判断系统 - 项目概览

> 本文档记录了系统的所有关键信息，用于快速了解项目架构和功能特点

## 📋 项目基本信息

- **项目名称**: A股量化买卖点判断系统
- **项目类型**: 量化交易分析系统
- **开发语言**: Python 3
- **主要框架**: Flask (Web服务)
- **数据来源**: Tushare Pro API
- **部署方式**: Docker + Nginx + Gunicorn

## 🎯 核心功能

### 1. 技术指标计算 (indicators.py)
系统支持以下技术指标的自动计算：
- **均线 (MA)**: MA5, MA10, MA20, MA60
- **MACD**: DIF, DEA, MACD柱
- **RSI**: 14日相对强弱指标
- **布林带 (Bollinger)**: 上轨、中轨、下轨、带宽、价格位置
- **KDJ**: K值、D值、J值
- **成交量指标**: 5日均量、量比

### 2. 多策略信号系统 (strategy.py)
系统实现了6种独立的交易策略：

#### 策略1: MA+MACD (传统策略)
- **买入信号**: MA5上穿MA20 且 MACD金叉
- **卖出信号**: MA5下穿MA20 或 MACD死叉
- **权重**: 30分

#### 策略2: 布林带 (Bollinger)
- **买入信号**: 价格触及下轨后回升
- **卖出信号**: 价格触及上轨后回落
- **权重**: 20分

#### 策略3: KDJ
- **买入信号**: K上穿D 且 K<30 (超卖区金叉)
- **卖出信号**: K下穿D 且 K>70 (超买区死叉)
- **权重**: 15分

#### 策略4: RSI
- **买入信号**: RSI<30超卖且开始反弹
- **卖出信号**: RSI>70超买且开始回落
- **权重**: 15分

#### 策略5: 成交量突破 (Volume)
- **买入信号**: 价格突破20日最高 + 量比>2 (放量突破)
- **卖出信号**: 价格跌破20日最低 或 缩量
- **权重**: 20分

#### 策略6: 综合策略 (Combined)
- **算法**: 加权评分系统，综合上述5种策略
- **评分区间**: -100 ~ +100
- **信号等级**:
  - 强烈买入(2): ≥60分
  - 买入(1): ≥40分
  - 观望(0): -40~40分
  - 卖出(-1): ≤-40分
  - 强烈卖出(-2): ≤-60分

### 3. 回测系统 (backtest.py)
对每个策略进行历史数据回测，计算以下指标：

#### 收益指标
- **总收益率**: 回测期间总收益 (%)
- **年化收益率**: 按365天年化后的收益率
- **最终资金**: 初始1元资金的最终价值

#### 交易统计
- **交易次数**: 完整买卖对的数量
- **胜率**: 盈利交易占比 (%)
- **盈亏比**: 平均盈利 / 平均亏损
- **平均盈利**: 盈利交易的平均收益率
- **平均亏损**: 亏损交易的平均亏损率

#### 风险指标
- **最大回撤**: 资金最大回撤幅度 (%)
- **夏普比率**: 风险调整后收益 (>1为优秀)
- **平均持仓天数**: 单笔交易平均持仓时间

### 4. 综合评分系统 (backtest.calc_score)
0-100分制，由以下维度组成：

| 维度 | 分值 | 说明 |
|------|------|------|
| 趋势分 | 30分 | MA+MACD形态 (多头30分/均线多头20分/MACD多头15分/空头5分) |
| RSI分 | 20分 | RSI位置 (低位20分/超卖16分/中位14分/超买6分) |
| 成交量分 | 10分 | 量比状态 (正常10分/放量8分/缩量5分/异常4分) |
| 策略胜率 | 20分 | 最佳策略历史胜率 (≥65%得20分) |
| 策略收益 | 10分 | 最佳策略年化收益 (>30%得10分) |
| 夏普比率 | 10分 | 风险调整收益 (>2得10分) |

**评级标准**:
- A级 (80-100分): 强烈推荐买入
- B级 (65-79分): 可以买入
- C级 (50-64分): 谨慎买入，控制仓位
- D级 (35-49分): 观望为主
- E级 (<35分): 不建议买入

### 5. 数据管理 (data.py)
- **数据来源**: Tushare Pro API (需要token)
- **缓存机制**: SQLite本地缓存，避免重复请求
- **数据类型**: 前复权日线数据 (最新价格为实际价格)
- **缓存策略**: 每日更新一次，覆盖查询范围则直接使用缓存
- **数据库表**:
  - daily_data: 日线K线数据
  - stock_info: 股票基本信息 (代码、名称、行业)
  - cache_meta: 缓存元数据 (更新时间、数据范围)

## 🚀 使用方式

### 命令行模式 (main.py)

#### 基本用法
```bash
# 分析单只股票 (显示所有策略详情)
python main.py 000001

# 分析多只股票
python main.py 000001 600000 601318

# 简洁模式 - 只显示综合策略
python main.py 000001 -c

# 最佳策略模式
python main.py 000001 -b

# 指定策略显示
python main.py 000001 -s macd           # 只显示MA+MACD策略
python main.py 000001 -s kdj,rsi        # 显示KDJ和RSI策略
python main.py 000001 -s combined       # 只显示综合策略

# 列出所有可用策略
python main.py --list
```

#### 策略别名
- macd, ma → MA+MACD
- boll, bollinger → Bollinger
- kdj → KDJ
- rsi → RSI
- vol, volume → Volume
- combo, combined → Combined

### Web API 模式 (app.py)

#### 启动服务
```bash
# 开发模式
python app.py

# 生产模式 (使用gunicorn)
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

#### API 接口

**1. 分析单只股票**
```
GET /api/analyze/<stock_code>?years=3

示例: GET /api/analyze/000001?years=3

返回:
{
  "success": true,
  "data": {
    "ts_code": "000001.SZ",
    "name": "平安银行",
    "current_price": 10.52,
    "current_date": "2025-01-15",
    "score": {
      "total": 75,
      "grade": "B",
      "advice": "可以买入",
      ...
    },
    "strategies": {
      "MA+MACD": {...},
      "Bollinger": {...},
      ...
    },
    "current_signals": {
      "signal": 1,
      "signal_combined": 2,
      ...
    },
    "current_pattern": {...},
    "pattern_desc": [...]
  }
}
```

**2. 批量分析**
```
POST /api/batch_analyze
Body: {"codes": ["000001", "600000", "601318"]}

返回:
{
  "success": true,
  "data": [
    {
      "code": "000001.SZ",
      "name": "平安银行",
      "price": 10.52,
      "score": 75,
      "grade": "B",
      "best_strategy": "Combined",
      "annual_return": 23.5,
      "win_rate": 65.2
    },
    ...
  ]
}
```

**3. 获取策略列表**
```
GET /api/strategies

返回: 所有可用策略的列表和描述
```

**4. 搜索股票**
```
GET /api/search?q=平安

返回: 匹配的股票列表
```

**5. 健康检查**
```
GET /health

返回: 服务状态和版本信息
```

### 批量分析工具 (batch_analyze.py)

```bash
python batch_analyze.py
```

功能:
- 批量分析预设的股票列表 (约50只股票)
- 自动筛选出买点股票
- 生成详细报告 (控制台输出 + CSV格式)
- 买点判断标准:
  1. 最佳策略给出买入信号
  2. 综合策略买入(评分≥40)
  3. RSI超卖且历史胜率≥60%
  4. 综合评分≥65分(B级以上)

## 📁 项目结构

```
/Users/lu/quant/
├── app.py                 # Flask Web应用主程序
├── main.py               # 命令行主程序入口
├── strategy.py           # 策略信号生成模块
├── backtest.py           # 回测引擎和评分系统
├── indicators.py         # 技术指标计算模块
├── data.py               # 数据获取和缓存模块
├── config.py             # 配置文件 (Tushare token等)
├── batch_analyze.py      # 批量分析工具
├── requirements.txt      # Python依赖包
├── Dockerfile            # Docker镜像配置
├── docker-compose.yml    # Docker Compose配置
├── deploy-local.sh       # 本地部署脚本
├── deploy-aliyun.sh      # 阿里云部署脚本
├── setup.sh              # 环境初始化脚本
├── DEPLOY.md             # 部署文档
├── .env.example          # 环境变量示例
├── cache/                # 数据缓存目录
│   └── stock_data.db     # SQLite数据库
├── templates/            # HTML模板
│   └── index.html        # Web前端页面
├── static/               # 静态资源
└── nginx/                # Nginx配置
```

## 🔧 技术栈

### 后端
- **Python 3**: 主要开发语言
- **Flask 3.0**: Web框架
- **pandas 2.1**: 数据处理
- **numpy 1.26**: 数值计算
- **tushare 1.4**: 股票数据API
- **gunicorn 21.2**: WSGI HTTP服务器

### 数据存储
- **SQLite**: 本地缓存数据库

### 部署
- **Docker**: 容器化部署
- **Nginx**: 反向代理和静态文件服务
- **Docker Compose**: 多容器编排

## 💡 设计特点

### 1. 多策略组合
- 6种独立策略互相验证
- 综合策略加权融合多个信号
- 避免单一策略的局限性

### 2. 完整的回测验证
- 每个策略都有历史回测数据支撑
- 计算胜率、收益率、风险指标
- 基于历史表现选择最佳策略

### 3. 智能评分系统
- 多维度综合评估 (趋势+RSI+成交量+策略表现)
- A-E五级评级，清晰的操作建议
- 量化评分，避免主观判断

### 4. 高效数据缓存
- SQLite本地缓存，减少API调用
- 智能更新策略，每日最多更新一次
- 前复权数据，保证技术分析准确性

### 5. 灵活的使用方式
- 命令行模式：适合快速查询和批量分析
- Web API模式：适合集成到其他系统
- 批量分析工具：适合日常选股筛选

## 📊 输出示例

### 命令行输出 (综合模式)
```
==================================================
股票: 000001.SZ (平安银行)
==================================================
正在分析...

当前价格: 10.52 元 (2025-01-15)

综合评分: 🟢 75分 (B级) - 可以买入
综合策略: 🔥 强烈买入  (信号评分: 80/100)

历史表现:
  交易次数: 15 笔
  总收益: +52.30%  年化: +23.50%
  胜率: 66.7% (10/15)
  最大回撤: -8.50%
  夏普比率: 1.85
```

### Web API输出
参见上文API接口部分的返回示例

## 🔐 配置要求

### 必需配置
1. **Tushare Token**: 需要在config.py中配置你的token
   - 获取地址: https://tushare.pro/user/token
   - 免费账户每天有调用限制

### 可选配置
- SECRET_KEY: Flask密钥 (生产环境必须修改)
- CACHE_DIR: 缓存目录路径
- DB_PATH: SQLite数据库路径

## 🚀 部署方式

### 本地运行
```bash
# 安装依赖
pip install -r requirements.txt

# 运行Web服务
python app.py

# 或运行命令行
python main.py 000001
```

### Docker部署
```bash
# 本地Docker部署
./deploy-local.sh

# 阿里云部署
./deploy-aliyun.sh
```

详细部署说明请参考 DEPLOY.md

## 📝 注意事项

### 数据相关
1. **复权方式**: 系统使用前复权数据进行技术分析，最新价格为实际价格
2. **数据延迟**: Tushare数据通常有1天延迟，当日数据可能不可用
3. **缓存策略**: 每日自动更新，如需强制刷新需删除cache目录

### 策略相关
1. **回测偏差**: 历史表现不代表未来收益
2. **信号延迟**: 信号基于收盘价生成，实际买入价可能不同
3. **交易成本**: 回测未考虑手续费和滑点

### 风险提示
1. 本系统仅供学习和研究使用
2. 不构成任何投资建议
3. 股市有风险，投资需谨慎
4. 请根据自身情况谨慎决策

## 🎓 快速上手建议

### 首次使用
1. 配置config.py中的Tushare token
2. 运行 `python main.py 000001` 测试系统
3. 查看输出结果，熟悉各项指标含义
4. 尝试不同的参数和模式 (-c, -b, -s等)

### 日常使用
1. 使用批量分析工具筛选买点: `python batch_analyze.py`
2. 对感兴趣的股票深入分析: `python main.py 股票代码 -c`
3. 查看最佳策略表现: `python main.py 股票代码 -b`

### 进阶使用
1. 通过Web API集成到自己的系统
2. 修改策略权重和参数 (strategy.py)
3. 添加自定义策略
4. 调整评分系统权重 (backtest.py)

## 📚 相关文档

- DEPLOY.md: 详细部署指南
- requirements.txt: Python依赖列表
- .env.example: 环境变量配置示例

## 🔄 后续如何使用本文档

### 在新会话开始时
当您启动新的terminal会话时，只需告诉我:

```
"请读取 /Users/lu/quant/PROJECT_OVERVIEW.md"
```

或者更简单:

```
"读一下项目概览"
```

或者:

```
"查看量化系统文档"
```

我会立即读取这个文档，快速了解整个系统的架构、功能和使用方式，无需重新分析代码。

---

**文档创建时间**: 2026-01-15
**系统版本**: v1.0.0
**维护建议**: 当系统有重大功能更新时，请同步更新本文档
